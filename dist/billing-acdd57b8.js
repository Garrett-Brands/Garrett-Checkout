"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[876],{48574:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var s=n(97582),i=n(91074),r=n(67627),a=n(92574),o=n(19053),d=n(95593),l=n(88870),u=n(69638),c=n(55409),g=n(76741),m=n(74161),p=n(98119),h=n(76417),f=n(19686),v=n(56204),b=n(97204),A=n(24648),_=n(78500),C=n(96543),E=n(34323),Z=n(42182),y=n(17175),S=n(67570),F=n(60452),k=n(16206),w=n(78379),M=n(45855),U=n(77683);const L=(0,v.Z)((0,h.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,n=e.customerMessage,i=e.billingAddress;return(0,s.__assign)((0,s.__assign)({},(0,C.Z)(t(i&&i.countryCode),i)),{orderComment:n})},isInitialValid:function(e){var t=e.billingAddress,n=e.getFields,s=e.language;return!!t&&(0,E.Z)({language:s,formFields:n(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,n=e.getFields;return"amazonpay"===e.methodId?(0,f.Vo)((function(e){return(0,y.Z)({translate:(0,E.w)(t),formFields:n(e&&e.countryCode)})})):(0,f.Vo)((function(e){return(0,E.Z)({language:t,formFields:n(e&&e.countryCode)})}))},enableReinitialize:!0})((function(e){var t=e.googleMapsApiKey,n=e.billingAddress,i=e.countriesWithAutocomplete,d=e.customer,l=d.addresses,u=d.isGuest,c=e.getFields,g=e.countries,m=e.isUpdating,p=e.setFieldValue,h=e.shouldShowOrderComments,f=e.values,v=e.methodId,C=e.isFloatingLabelEnabled,E=e.updateAddress,y=e.onUnhandledError,L=(0,r.useState)(!1),B=L[0],I=L[1],z=(0,r.useRef)(null),D=(0,Z.Z)(),P=D.isPayPalAxoEnabled,N=D.mergedBcAndPayPalConnectAddresses,V="amazonpay"===v,K=c(f.countryCode),O=K.filter((function(e){return e.custom})),x=O.length>0,W=V&&x?O:K,R=P?N:l,G=(null==R?void 0:R.length)>0,J=n&&(0,b.Z)(n,R,c(n.countryCode)),T=function(e){return(0,s.__awaiter)(void 0,void 0,void 0,(function(){var t;return(0,s.__generator)(this,(function(n){switch(n.label){case 0:I(!0),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,E(e)];case 2:return n.sent(),[3,5];case 3:return(t=n.sent())instanceof Error&&y(t),[3,5];case 4:return I(!1),[7];case 5:return[2]}}))}))};return r.createElement(k.Z,{autoComplete:"on"},V&&n&&r.createElement("div",{className:"form-fieldset"},r.createElement(U.Z,{address:n})),r.createElement(w.Z,{id:"checkoutBillingAddress",ref:z},G&&!V&&r.createElement(w.Z,{id:"billingAddresses"},r.createElement(M.Z,{isLoading:B},r.createElement(A.Z,{addresses:R,onSelectAddress:T,onUseNewAddress:function(){T({})},selectedAddress:J?n:void 0}))),!J&&r.createElement(o.Z,{isLoading:B},r.createElement(_.Z,{countries:g,countriesWithAutocomplete:i,countryCode:f.countryCode,formFields:W,googleMapsApiKey:t,isFloatingLabelEnabled:C,setFieldValue:p,shouldShowSaveAddress:!u}))),h&&r.createElement(S.Z,null),r.createElement("div",{className:"form-actions"},r.createElement(F.ZP,{disabled:m||B,id:"checkout-billing-continue",isLoading:m||B,type:"submit",variant:F.Wu.Primary},r.createElement(a.Z,{id:"common.continue_action"}))))})));var B=n(41957);function I(e){var t=(0,B.Z)(e);return t&&["amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSubmit=function(e){return(0,s.__awaiter)(t,void 0,void 0,(function(){var t,n,i,r,a,o,u,c,g,m,p,h,f,v,b,A,_=e.orderComment,C=(0,s.__rest)(e,["orderComment"]);return(0,s.__generator)(this,(function(e){switch(e.label){case 0:t=this.props,n=t.updateAddress,i=t.updateCheckout,r=t.customerMessage,a=t.billingAddress,o=t.navigateNextStep,u=t.onUnhandledError,c=t.shipDate,g=t.arrivalDate,m=t.giftMessage,C&&(p=c.toLocaleDateString("en-US"),h=g.toLocaleDateString("en-US"),f=m.toString(),C.customFields.field_30=p,C.customFields.field_38=h,C.customFields.field_32=f),v=[],(b=(0,d.Z)(C))&&!(0,l.Z)(b,a)&&v.push(n(b)),r!==_&&v.push(i({customerMessage:_})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Promise.all(v)];case 2:return e.sent(),o(),[3,4];case 3:return(A=e.sent())instanceof Error&&u(A),[3,4];case 4:return[2]}}))}))},t}return(0,s.__extends)(t,e),t.prototype.componentDidMount=function(){return(0,s.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r,a,o;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:e=this.props,t=e.initialize,n=e.onReady,r=void 0===n?i.noop:n,a=e.onUnhandledError,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,t()];case 2:return s.sent(),r(),[3,4];case 3:return(o=s.sent())instanceof Error&&a(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.updateAddress,n=e.isInitializing,i=(e.shipDate,e.arrivalDate,e.giftMessage,(0,s.__rest)(e,["updateAddress","isInitializing","shipDate","arrivalDate","giftMessage"]));return r.createElement(o.Z,{isLoading:n},r.createElement("div",{className:"checkout-form"},r.createElement("div",{className:"form-legend-container"},r.createElement(p.Z,{testId:"billing-address-heading"},r.createElement(a.Z,{id:"billing.billing_address_heading"}))),r.createElement(L,(0,s.__assign)({},i,{onSubmit:this.handleSubmit,updateAddress:t}))))},t}(r.Component);const D=(0,u.Z)((function(e){var t=e.checkoutService,n=e.checkoutState,s=n.data,i=s.getCheckout,r=s.getConfig,a=s.getCart,o=s.getCustomer,d=s.getBillingAddress,l=s.getBillingAddressFields,u=s.getBillingCountries,p=n.statuses,h=p.isLoadingBillingCountries,f=p.isUpdatingBillingAddress,v=p.isUpdatingCheckout,b=r(),A=o(),_=i(),C=a();if(!(b&&A&&_&&C))return null;var E=b.checkoutSettings,Z=E.enableOrderComments,y=E.googleMapsApiKey,S=["US","CA","AU","NZ"];return E.features["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&S.push("GB"),{billingAddress:d(),countries:u()||c.L,countriesWithAutocomplete:S,customer:A,customerMessage:_.customerMessage,getFields:l,googleMapsApiKey:y,initialize:t.loadBillingAddressFields,isInitializing:h(),isUpdating:f()||v(),methodId:I(_),shouldShowOrderComments:Z&&(0,m.Z)(C)<1,updateAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout,isFloatingLabelEnabled:(0,g.Z)(b.checkoutSettings)}}))(z)}}]);
//# sourceMappingURL=billing-acdd57b8.js.map