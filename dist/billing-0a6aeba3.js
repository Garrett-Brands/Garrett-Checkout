"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[876],{48574:(e,t,s)=>{s.r(t),s.d(t,{default:()=>B});var n=s(86940),i=s(91074),r=s(67627),a=s(95593),o=s(88870),d=s(49890),l=s(55409),u=s(70140),c=s(74161),m=s(98119),g=s(45855),h=s(41957);function p(e){var t=(0,h.Z)(e);return t&&["amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var f=s(76417),v=s(19686),A=s(97204),C=s(24648),Z=s(53537),b=s(96543),y=s(34323),S=s(17175),E=s(43276),F=s(67570),k=s(60452),U=s(16206),w=s(78379),M=s(77683),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isResettingAddress:!1},t.addressFormRef=(0,r.createRef)(),t.handleSelectAddress=function(e){return(0,n.mG)(t,void 0,void 0,(function(){var t,s,i,r;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:t=this.props,s=t.updateAddress,i=t.onUnhandledError,this.setState({isResettingAddress:!0}),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,s(e)];case 2:return n.sent(),[3,5];case 3:return r=n.sent(),i(r),[3,5];case 4:return this.setState({isResettingAddress:!1}),[7];case 5:return[2]}}))}))},t.handleUseNewAddress=function(){t.handleSelectAddress({})},t}return(0,n.ZT)(t,e),t.prototype.render=function(){var e=this.props,t=e.googleMapsApiKey,s=e.billingAddress,n=e.countriesWithAutocomplete,i=e.customer,a=i.addresses,o=i.isGuest,d=e.getFields,l=e.countries,c=e.isUpdating,m=e.setFieldValue,h=e.shouldShowOrderComments,p=e.values,f="amazonpay"===e.methodId,v=d(p.countryCode),b=v.filter((function(e){return e.custom})),y=b.length>0,S=f&&y?b:v,E=this.state.isResettingAddress,_=a&&a.length>0,I=s&&(0,A.Z)(s,a,d(s.countryCode));return r.createElement(U.Z,{autoComplete:"on"},f&&s&&r.createElement("div",{className:"form-fieldset"},r.createElement(M.Z,{address:s})),r.createElement(w.Z,{id:"checkoutBillingAddress",ref:this.addressFormRef},_&&!f&&r.createElement(w.Z,{id:"billingAddresses"},r.createElement(g.Z,{isLoading:E},r.createElement(C.Z,{addresses:a,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:I?s:void 0}))),!I&&r.createElement(g.Z,{isLoading:E},r.createElement(Z.Z,{countries:l,countriesWithAutocomplete:n,countryCode:p.countryCode,formFields:S,googleMapsApiKey:t,setFieldValue:m,shouldShowSaveAddress:!o}))),h&&r.createElement(F.Z,null),r.createElement("div",{className:"form-actions"},r.createElement(k.ZP,{disabled:c||E,id:"checkout-billing-continue",isLoading:c||E,type:"submit",variant:k.Wu.Primary},r.createElement(u.Z,{id:"common.continue_action"}))))},t}(r.PureComponent);const I=(0,E.Z)((0,f.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,s=e.customerMessage,i=e.billingAddress;return(0,n.pi)((0,n.pi)({},(0,b.Z)(t(i&&i.countryCode),i)),{orderComment:s})},isInitialValid:function(e){var t=e.billingAddress,s=e.getFields,n=e.language;return!!t&&(0,y.Z)({language:n,formFields:s(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,s=e.getFields;return"amazonpay"===e.methodId?(0,v.Vo)((function(e){return(0,S.Z)({translate:(0,y.w)(t),formFields:s(e&&e.countryCode)})})):(0,v.Vo)((function(e){return(0,y.Z)({language:t,formFields:s(e&&e.countryCode)})}))},enableReinitialize:!0})(_));var z=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSubmit=function(e){return(0,n.mG)(t,void 0,void 0,(function(){var t,s,i,r,d,l,u,c,m,g,h,p,f,v,A,C,Z=e.orderComment,b=(0,n._T)(e,["orderComment"]);return(0,n.Jh)(this,(function(e){switch(e.label){case 0:t=this.props,s=t.updateAddress,i=t.updateCheckout,r=t.customerMessage,d=t.billingAddress,l=t.navigateNextStep,u=t.onUnhandledError,c=t.shipDate,m=t.arrivalDate,g=t.giftMessage,b&&(h=c.toLocaleDateString("en-US"),p=m.toLocaleDateString("en-US"),f=g.toString(),b.customFields.field_30=h,b.customFields.field_38=p,b.customFields.field_32=f),v=[],(A=(0,a.Z)(b))&&!(0,o.Z)(A,d)&&v.push(s(A)),r!==Z&&v.push(i({customerMessage:Z})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Promise.all(v)];case 2:return e.sent(),l(),[3,4];case 3:return C=e.sent(),u(C),[3,4];case 4:return[2]}}))}))},t}return(0,n.ZT)(t,e),t.prototype.componentDidMount=function(){return(0,n.mG)(this,void 0,void 0,(function(){var e,t,s,r,a,o;return(0,n.Jh)(this,(function(n){switch(n.label){case 0:e=this.props,t=e.initialize,s=e.onReady,r=void 0===s?i.noop:s,a=e.onUnhandledError,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t()];case 2:return n.sent(),r(),[3,4];case 3:return o=n.sent(),a(o),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.updateAddress,s=e.isInitializing,i=(e.shipDate,e.arrivalDate,e.giftMessage,(0,n._T)(e,["updateAddress","isInitializing","shipDate","arrivalDate","giftMessage"]));return r.createElement("div",{className:"checkout-form"},r.createElement("div",{className:"form-legend-container"},r.createElement(m.Z,{testId:"billing-address-heading"},r.createElement(u.Z,{id:"billing.billing_address_heading"}))),r.createElement(g.Z,{isLoading:s,unmountContentWhenLoading:!0},r.createElement(I,(0,n.pi)({},i,{onSubmit:this.handleSubmit,updateAddress:t}))))},t}(r.Component);const B=(0,d.Z)((function(e){var t=e.checkoutService,s=e.checkoutState,n=s.data,i=n.getCheckout,r=n.getConfig,a=n.getCart,o=n.getCustomer,d=n.getBillingAddress,u=n.getBillingAddressFields,m=n.getBillingCountries,g=s.statuses,h=g.isLoadingBillingCountries,f=g.isUpdatingBillingAddress,v=g.isUpdatingCheckout,A=r(),C=o(),Z=i(),b=a();if(!(A&&C&&Z&&b))return null;var y=A.checkoutSettings,S=y.enableOrderComments,E=y.googleMapsApiKey,F=["US","CA","AU","NZ"];return y.features["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&F.push("GB"),{billingAddress:d(),countries:m()||l.L,countriesWithAutocomplete:F,customer:C,customerMessage:Z.customerMessage,getFields:u,googleMapsApiKey:E,initialize:t.loadBillingAddressFields,isInitializing:h(),isUpdating:f()||v(),methodId:p(Z),shouldShowOrderComments:S&&(0,c.Z)(b)<1,updateAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout}}))(z)}}]);
//# sourceMappingURL=billing-0a6aeba3.js.map